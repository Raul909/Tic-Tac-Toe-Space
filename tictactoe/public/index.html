<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe - Mission Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            space: '#000510',
            nasa: '#00d4ff',
            mars: '#ff6b35',
            earth: '#4dffdb'
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Space+Mono&display=swap');
    
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body { 
      font-family: 'Space Mono', monospace;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3 { font-family: 'Exo 2', sans-serif; }
    
    button, a, [x-on\\:click] {
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    
    #three-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      will-change: transform;
      transform: translateZ(0);
    }
    
    .content-layer {
      position: relative;
      z-index: 1;
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-font-smoothing: antialiased;
    }
    
    .nasa-bracket {
      position: relative;
    }
    .nasa-bracket::before,
    .nasa-bracket::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid #00d4ff;
    }
    .nasa-bracket::before {
      top: -1px;
      left: -1px;
      border-right: none;
      border-bottom: none;
    }
    .nasa-bracket::after {
      bottom: -1px;
      right: -1px;
      border-left: none;
      border-top: none;
    }
    
    .glass {
      background: rgba(0, 5, 16, 0.85);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(0, 212, 255, 0.3);
      will-change: transform;
      transform: translateZ(0);
    }
    
    @keyframes scan {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100vh); }
    }
    .scan-line {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to bottom, transparent, rgba(0, 212, 255, 0.5), transparent);
      animation: scan 8s linear infinite;
      pointer-events: none;
      z-index: 100;
    }
    
    #space-gallery-canvas {
      width: 100%;
      height: 500px;
      border-radius: 0.5rem;
      cursor: grab;
    }
    #space-gallery-canvas:active {
      cursor: grabbing;
    }
    
    .space-object-item {
      padding: 0.75rem;
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .space-object-item:hover {
      background: rgba(0, 212, 255, 0.15);
      border-color: rgba(0, 212, 255, 0.5);
    }
    .space-object-item.active {
      background: rgba(0, 212, 255, 0.25);
      border-color: #00d4ff;
    }
    
    /* Winning Animation */
    @keyframes winPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(0, 212, 255, 0);
      }
      25% {
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 50px rgba(0, 212, 255, 1);
      }
      75% {
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
      }
    }
    
    @keyframes winGlow {
      0%, 100% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(2);
      }
    }
    
    .winning-cell {
      animation: winPulse 0.6s ease-in-out, winGlow 1s ease-in-out infinite !important;
      background: rgba(0, 212, 255, 0.3) !important;
      border-color: #00d4ff !important;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.8) !important;
    }
    
    /* Victory Screen Animation */
    @keyframes victoryBounce {
      0%, 100% {
        transform: scale(1) rotate(0deg);
      }
      25% {
        transform: scale(1.2) rotate(-5deg);
      }
      50% {
        transform: scale(1.1) rotate(5deg);
      }
      75% {
        transform: scale(1.2) rotate(-5deg);
      }
    }
    
    @keyframes victoryShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        font-size: 14px;
      }
      
      h1 {
        font-size: 1.5rem !important;
      }
      
      h2 {
        font-size: 1.25rem !important;
      }
      
      .glass {
        padding: 1rem !important;
      }
      
      button {
        padding: 0.5rem 1rem !important;
        font-size: 0.875rem !important;
      }
      
      #space-gallery-3d {
        height: 300px !important;
      }
      
      .grid {
        grid-template-columns: 1fr !important;
      }
      
      .space-object-item {
        padding: 0.5rem !important;
        font-size: 0.875rem !important;
      }
      
      /* Game board mobile */
      .grid-cols-3 {
        gap: 0.5rem !important;
      }
      
      /* Hide scan line on mobile for performance */
      .scan-line {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.25rem !important;
      }
      
      .glass {
        padding: 0.75rem !important;
      }
      
      button {
        padding: 0.4rem 0.8rem !important;
        font-size: 0.75rem !important;
      }
      
      #space-gallery-3d {
        height: 250px !important;
      }
      
      input {
        font-size: 14px !important;
      }
    }
    
    /* Touch-friendly interactions */
    @media (hover: none) and (pointer: coarse) {
      button, .space-object-item {
        min-height: 44px;
        min-width: 44px;
      }
      
      .space-object-item {
        padding: 1rem !important;
      }
    }
  </style>
</head>
<body class="bg-space text-white min-h-screen overflow-x-hidden" x-data="app()" x-init="init()">
  <button @click="toggleMute()" class="fixed top-4 right-4 z-50 glass p-2 rounded-full hover:bg-gray-800 transition" :class="muted ? 'text-gray-500' : 'text-nasa'"><svg x-show="!muted" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg><svg x-show="muted" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg></button>
  
  <canvas id="three-canvas"></canvas>
  <div class="scan-line"></div>
  <canvas id="fw-canvas" style="position:fixed;inset:0;pointer-events:none;z-index:99"></canvas>
  
  <!-- Auth Screen -->
  <div x-show="screen === 'auth'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
      <div class="text-center mb-8">
        <div class="text-nasa text-sm tracking-widest mb-2">‚óÜ MISSION CONTROL ‚óÜ</div>
        <h1 class="text-5xl font-bold tracking-wider mb-2">TIC TAC TOE</h1>
        <p class="text-gray-400 text-sm tracking-wide">TACTICAL GRID COMBAT SYSTEM</p>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-6 shadow-2xl">
        <div class="flex gap-2 mb-6">
          <button @click="authTab = 'login'" 
                  :class="authTab === 'login' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            SIGN IN
          </button>
          <button @click="authTab = 'register'" 
                  :class="authTab === 'register' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            REGISTER
          </button>
        </div>
        
        <!-- Google Sign In Button -->
        <button @click="loginWithGoogle()" class="w-full bg-white text-gray-800 font-bold py-3 rounded hover:bg-gray-100 transition mb-2 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" viewBox="0 0 24 24">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Continue with Google
        </button>
        
        <!-- Facebook Sign In Button -->
        <button @click="loginWithFacebook()" class="w-full bg-blue-600 text-white font-bold py-3 rounded hover:bg-blue-700 transition mb-4 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
          Continue with Facebook
        </button>
        
        <div class="relative mb-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-700"></div>
          </div>
          <div class="relative flex justify-center text-xs">
            <span class="px-2 bg-gray-900 text-gray-400">OR</span>
          </div>
        </div>
        
        <form x-show="authTab === 'login'" @submit.prevent="login()" class="space-y-4">
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN</label>
            <input x-model="loginForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Enter callsign">
          </div>
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE</label>
            <input x-model="loginForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div x-show="loginError" x-text="loginError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="loginLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!loginLoading">INITIATE LOGIN ‚Üí</span>
            <span x-show="loginLoading">AUTHENTICATING...</span>
          </button>
        </form>
        
        <form x-show="authTab === 'register'" @submit.prevent="register()" class="space-y-4">
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN <span class="text-gray-500">(3-16 chars)</span></label>
            <input x-model="registerForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Choose callsign">
          </div>
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE <span class="text-gray-500">(min 8 chars)</span></label>
            <input x-model="registerForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Set access code">
          </div>
          <div x-show="registerError" x-text="registerError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="registerLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!registerLoading">REGISTER OPERATOR ‚Üí</span>
            <span x-show="registerLoading">CREATING...</span>
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Lobby Screen -->
  <div x-show="screen === 'lobby'" class="content-layer min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <div>
          <div class="text-nasa text-xs tracking-widest">‚óÜ MISSION CONTROL ‚óÜ</div>
          <div class="text-3xl font-bold tracking-wide" x-text="user.username"></div>
        </div>
        <div class="flex gap-2">
          <button @click="openSpaceGallery()" class="bg-gray-800 px-4 py-2 rounded hover:bg-gray-700 transition font-bold">üåå SPACE</button>
          <button @click="logout()" class="bg-gray-800 px-4 py-2 rounded hover:bg-gray-700 transition font-bold">LOGOUT</button>
        </div>
      </div>
      
      <div class="flex gap-4 mb-6">
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">W-</span><span class="font-bold text-lg" x-text="String(user.stats.wins).padStart(2, '0')">00</span>
        </div>
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">D-</span><span class="font-bold text-lg" x-text="String(user.stats.draws).padStart(2, '0')">00</span>
        </div>
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">L-</span><span class="font-bold text-lg" x-text="String(user.stats.losses).padStart(2, '0')">00</span>
        </div>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-6 space-y-6 shadow-2xl">
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-4">üöÄ MULTIPLAYER MISSION</h3>
          <div class="flex gap-4">
            <button @click="createRoom()" class="flex-1 bg-nasa text-black font-bold py-4 rounded hover:bg-nasa/90 transition tracking-wide">
              + LAUNCH ROOM
            </button>
            <div class="flex-1 flex gap-2">
              <input x-model="joinCode" type="text" maxlength="4" placeholder="CODE"
                     class="flex-1 bg-gray-800 border border-gray-700 rounded px-4 uppercase text-center focus:border-nasa focus:outline-none transition">
              <button @click="joinRoom()" class="bg-gray-800 px-6 rounded hover:bg-gray-700 transition font-bold">DOCK ‚Üí</button>
            </div>
          </div>
          <div class="flex gap-4 mt-4">
             <button @click="createTournament()" class="flex-1 bg-purple-600 text-white font-bold py-4 rounded hover:bg-purple-700 transition tracking-wide">
               üèÜ HOST TOURNAMENT
             </button>
             <button @click="joinTournament()" class="flex-1 bg-purple-900/50 border border-purple-500 text-white font-bold py-4 rounded hover:bg-purple-900 transition tracking-wide">
               JOIN TOURNAMENT
             </button>
          </div>
          <div x-show="lobbyError" x-text="lobbyError" class="text-mars text-sm mt-2"></div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-4">ü§ñ TRAINING MODE</h3>
          <button @click="startAI()" class="w-full bg-mars text-white font-bold py-4 rounded hover:bg-mars/90 transition tracking-wide">
            ENGAGE AI
          </button>
          <button @click="openLeaderboard()" class="w-full bg-gray-800 text-nasa font-bold py-4 rounded hover:bg-gray-700 transition tracking-wide mt-4 border border-nasa/30">
            üìä VIEW LEADERBOARD
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Leaderboard -->
  <!-- Tournament Lobby -->
  <div x-show="screen === 'tournament-lobby'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 text-center shadow-2xl w-full max-w-lg">
      <div class="text-xl mb-4 text-nasa tracking-wider">TOURNAMENT LOBBY</div>
      <div class="text-6xl font-bold text-nasa mb-2 tracking-widest" x-text="tournamentCode"></div>
      <div class="text-gray-400 mb-6 text-sm tracking-wide">SHARE CODE TO JOIN</div>

      <div class="space-y-2 mb-8">
        <template x-for="(player, index) in tournamentPlayers" :key="index">
          <div class="glass p-3 flex justify-between items-center">
            <span class="text-nasa font-bold" x-text="'P' + (index + 1)"></span>
            <span class="font-mono" x-text="player.name"></span>
            <span class="text-green-400 text-xs">READY</span>
          </div>
        </template>
        <template x-for="i in (4 - tournamentPlayers.length)" :key="'empty-' + i">
          <div class="glass p-3 flex justify-between items-center opacity-50">
             <span class="text-gray-600 font-bold">--</span>
             <span class="text-gray-600">WAITING...</span>
          </div>
        </template>
      </div>

      <button @click="setScreen('lobby')" class="block mx-auto text-gray-400 hover:text-white transition">‚Üê ABORT</button>
    </div>
  </div>

  <!-- Tournament Bracket -->
  <div x-show="screen === 'tournament-bracket'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 w-full max-w-4xl shadow-2xl">
      <h2 class="text-3xl font-bold text-center mb-2 tracking-widest text-nasa">TOURNAMENT BRACKET</h2>
      <div class="text-center mb-8 text-sm text-gray-400" x-text="tournamentStatus === 'completed' ? 'CHAMPION DECLARED' : 'IN PROGRESS'"></div>

      <div x-show="tournamentChampion" class="text-center mb-8 animate-bounce">
         <div class="text-6xl mb-2">üèÜ</div>
         <div class="text-2xl font-bold text-nasa">CHAMPION</div>
         <div class="text-4xl font-bold text-white" x-text="tournamentChampion"></div>
      </div>

      <div class="flex justify-around items-center gap-8 relative">
        <!-- Semifinals Column -->
        <div class="space-y-12 flex-1">
          <!-- Match 1 -->
          <div class="glass p-4 relative" :class="tournamentMatches[0]?.winner !== null ? 'opacity-50' : ''">
             <div class="text-xs text-nasa mb-2">SEMIFINAL 1</div>
             <div class="flex justify-between p-2 border-b border-gray-700" :class="tournamentMatches[0]?.winner === 0 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[0]?.p1]?.name || '...'"></span>
               <span x-show="tournamentMatches[0]?.winner === 0">‚úì</span>
             </div>
             <div class="flex justify-between p-2" :class="tournamentMatches[0]?.winner === 1 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[0]?.p2]?.name || '...'"></span>
               <span x-show="tournamentMatches[0]?.winner === 1">‚úì</span>
             </div>
          </div>

          <!-- Match 2 -->
          <div class="glass p-4 relative" :class="tournamentMatches[1]?.winner !== null ? 'opacity-50' : ''">
             <div class="text-xs text-nasa mb-2">SEMIFINAL 2</div>
             <div class="flex justify-between p-2 border-b border-gray-700" :class="tournamentMatches[1]?.winner === 2 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[1]?.p1]?.name || '...'"></span>
               <span x-show="tournamentMatches[1]?.winner === 2">‚úì</span>
             </div>
             <div class="flex justify-between p-2" :class="tournamentMatches[1]?.winner === 3 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[1]?.p2]?.name || '...'"></span>
               <span x-show="tournamentMatches[1]?.winner === 3">‚úì</span>
             </div>
          </div>
        </div>

        <!-- Final Column -->
        <div class="flex-1">
           <div class="glass p-6 border-2 border-nasa/50 relative">
             <div class="text-xs text-nasa mb-2 text-center">FINAL MISSION</div>
             <div class="flex justify-between p-3 border-b border-gray-700" :class="tournamentMatches[2]?.winner === tournamentMatches[2]?.p1 && tournamentMatches[2]?.p1 !== null ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentMatches[2]?.p1 !== null ? tournamentPlayers[tournamentMatches[2]?.p1]?.name : '...'"></span>
               <span x-show="tournamentMatches[2]?.winner === tournamentMatches[2]?.p1 && tournamentMatches[2]?.p1 !== null">üëë</span>
             </div>
             <div class="flex justify-between p-3" :class="tournamentMatches[2]?.winner === tournamentMatches[2]?.p2 && tournamentMatches[2]?.p2 !== null ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentMatches[2]?.p2 !== null ? tournamentPlayers[tournamentMatches[2]?.p2]?.name : '...'"></span>
               <span x-show="tournamentMatches[2]?.winner === tournamentMatches[2]?.p2 && tournamentMatches[2]?.p2 !== null">üëë</span>
             </div>
           </div>
        </div>
      </div>

      <div class="mt-8 text-center">
        <button @click="exitTournament()" class="bg-gray-800 px-6 py-2 rounded hover:bg-gray-700 transition font-bold">EXIT TO LOBBY</button>
      </div>
    </div>
  </div>
  <div x-show="screen === 'leaderboard'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 w-full max-w-2xl shadow-2xl relative">
      <button @click="closeLeaderboard()" class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>
      <h2 class="text-3xl font-bold text-center mb-6 tracking-widest text-nasa">GLOBAL LEADERBOARD</h2>

      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="border-b border-gray-700 text-xs text-gray-400 tracking-wider">
              <th class="p-3">RANK</th>
              <th class="p-3">CALLSIGN</th>
              <th class="p-3 text-right">WINS</th>
                <td class="p-3 text-right font-mono text-earth" x-text="player.draws"></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <div class="mt-6 text-center">
        <button @click="closeLeaderboard()" class="bg-gray-800 px-6 py-2 rounded hover:bg-gray-700 transition font-bold">‚Üê BACK TO BASE</button>
      </div>
    </div>
  </div>

  <div x-show="screen === 'space'" class="content-layer min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-4xl font-bold tracking-wider">üåå SPACE EXPLORER</h2>
        <button @click="closeSpaceGallery()" class="bg-gray-800 px-6 py-3 rounded hover:bg-gray-700 transition font-bold">‚Üê BACK</button>
      </div>
      
      <div class="flex gap-2 mb-4">
        <button @click="loadSpaceTab('solar')" 
                :class="spaceTab === 'solar' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">SOLAR SYSTEM</button>
        <button @click="loadSpaceTab('stars')" 
                :class="spaceTab === 'stars' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">NEARBY STARS</button>
        <button @click="loadSpaceTab('nebulae')" 
                :class="spaceTab === 'nebulae' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">NEBULAE</button>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
        <div class="lg:col-span-3">
          <div class="glass nasa-bracket rounded-lg p-4 shadow-2xl">
            <div id="space-gallery-3d" style="width: 100%; height: 500px;"></div>
            <div class="flex gap-4 mt-4">
              <button @click="resetSpaceView()" class="bg-gray-800 px-6 py-2 rounded hover:bg-gray-700 transition font-bold">RESET VIEW</button>
              <div class="text-xs text-gray-400 flex items-center gap-4">
                <span>üñ±Ô∏è Drag to rotate</span>
                <span>üîç Scroll to zoom</span>
                <span>üëÜ Click objects</span>
                <span>üåç Blue = Your Location</span>
                <span id="weather-indicator" class="text-nasa"></span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="glass rounded-lg p-4">
          <h3 class="text-nasa text-sm tracking-widest mb-4">OBJECTS</h3>
          <div class="space-y-2 max-h-96 overflow-y-auto" id="space-objects-list">
            <!-- Objects will be populated by JavaScript -->
          </div>
          
          <div x-show="selectedObject" class="mt-4 pt-4 border-t border-nasa/30">
            <h4 class="text-nasa text-xs tracking-widest mb-2">DETAILS</h4>
            <div class="text-sm space-y-1" id="space-object-details">
              <!-- Details will be populated -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Waiting, Game, Game Over screens remain the same as before -->
  <!-- (keeping them short for file size) -->
  
  <div x-show="screen === 'waiting'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 text-center shadow-2xl">
      <div class="text-xl mb-4 text-nasa tracking-wider">WAITING FOR OPPONENT...</div>
      <div class="text-7xl font-bold text-nasa mb-2 tracking-widest" x-text="roomCode"></div>
      <div class="text-gray-400 mb-6 text-sm tracking-wide">SHARE THIS CODE</div>
      <button @click="copyRoomCode()" class="bg-nasa text-black px-8 py-3 rounded font-bold hover:bg-nasa/90 transition mb-4">
        üìã COPY CODE
      </button>
      <button @click="cancelWaiting()" class="block mx-auto text-gray-400 hover:text-white transition">‚Üê ABORT MISSION</button>
    </div>
  </div>
  
  <div x-show="screen === 'game'" class="content-layer min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-6">
        <div class="text-nasa text-sm tracking-widest mb-2 uppercase" x-text="gameStatus"></div>
        <div class="flex justify-center gap-8 text-lg font-bold">
          <div class="glass rounded px-4 py-2 border border-mars/50">
            <span class="text-mars">X:</span> <span x-text="scores.X">0</span>
          </div>
          <div class="glass rounded px-4 py-2 border border-gray-500/50">
            <span class="text-gray-400">D:</span> <span x-text="scores.D">0</span>
          </div>
          <div class="glass rounded px-4 py-2 border border-earth/50">
            <span class="text-earth">O:</span> <span x-text="scores.O">0</span>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-3 max-w-md mx-auto mb-6">
        <template x-for="(cell, i) in board" :key="i">
          <button @click="makeMove(i)" 
                  :disabled="!canMove(i)"
                  :data-cell-index="i"
                  class="aspect-square glass nasa-bracket rounded-lg text-6xl font-bold hover:bg-gray-800/50 disabled:cursor-not-allowed transition-all shadow-lg"
                  :class="cell === 'X' ? 'text-mars border-mars/50' : cell === 'O' ? 'text-earth border-earth/50' : 'border-nasa/30'"
                  x-text="cell || ''">
          </button>
        </template>
      </div>
      
      <div class="text-center">
        <button @click="leaveGame()" class="bg-gray-800 px-8 py-3 rounded hover:bg-gray-700 transition font-bold">‚Üê ABORT MISSION</button>
      </div>
    </div>
  </div>
  
  <div x-show="gameOver" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="glass nasa-bracket rounded-lg p-8 text-center max-w-md shadow-2xl"
         x-transition:enter="transition ease-out duration-500 delay-150"
         x-transition:enter-start="opacity-0 scale-50"
         x-transition:enter-end="opacity-100 scale-100">
      <div class="text-6xl mb-4" 
           x-text="gameOverEmoji"
           :style="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY') ? 'animation: victoryBounce 1s ease-in-out infinite' : ''"></div>
      <div class="text-3xl font-bold mb-2" 
           x-text="gameOverTitle"
           :style="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY') ? 'animation: victoryShake 0.5s ease-in-out' : ''"></div>
      <div class="text-nasa text-sm mb-6 tracking-wider" x-text="gameOverSubtitle"></div>
      
      <!-- Social Share Section -->
      <div x-show="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY')" class="mb-6 pb-6 border-b border-nasa/30">
        <div class="text-xs text-gray-400 mb-3 tracking-wider">SHARE YOUR VICTORY</div>
        <div class="flex gap-2 justify-center flex-wrap">
          <button @click="shareTwitter()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path></svg>
            Twitter
          </button>
          <button @click="shareFacebook()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg>
            Facebook
          </button>
          <button @click="shareWhatsApp()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path></svg>
            WhatsApp
          </button>
          <button @click="downloadScreenshot()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            Screenshot
          </button>
          <button @click="copyShareLink()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            Copy Link
          </button>
        </div>
        <div x-show="shareCopied" class="text-xs text-earth mt-2 animate-pulse">‚úì Link copied to clipboard!</div>
      </div>
      
      <div class="flex gap-4">
        <button x-show="tournamentStatus" @click="viewBracket()" class="flex-1 bg-purple-600 text-white font-bold py-3 rounded hover:bg-purple-700 transition">VIEW BRACKET</button>
        <button x-show="!tournamentStatus" @click="rematch()" class="flex-1 bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition">
          RE-ENGAGE
        </button>
        <button @click="leaveGame()" class="flex-1 bg-gray-800 py-3 rounded hover:bg-gray-700 transition">
          ABORT
        </button>
      </div>
    </div>
  </div>

  <script src="/space-3d.js"></script>
  <script src="/space-gallery-3d.js"></script>
  <script src="/config.js"></script>
  <script src="/game-logic.js"></script>
  <script src="/sound-manager.js"></script>
  <script src="/app.js"></script>
</body>
</html>
