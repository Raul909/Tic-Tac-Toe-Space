<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tic Tac Toe - Mission Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="/mobile-optimizations.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            space: '#000510',
            nasa: '#00d4ff',
            mars: '#ff6b35',
            earth: '#4dffdb'
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Space+Mono&display=swap');
    
    * {
      -webkit-tap-highlight-color: transparent;
    }
    
    body { 
      font-family: 'Space Mono', monospace;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    h1, h2, h3 { font-family: 'Exo 2', sans-serif; }
    
    button, a, [x-on\\:click] {
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    
    #three-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      will-change: transform;
      transform: translateZ(0);
    }
    
    .content-layer {
      position: relative;
      z-index: 1;
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-font-smoothing: antialiased;
    }
    
    [x-cloak] { display: none !important; }
    
    .nasa-bracket {
      position: relative;
    }
    .nasa-bracket::before,
    .nasa-bracket::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid #00d4ff;
    }
    .nasa-bracket::before {
      top: -1px;
      left: -1px;
      border-right: none;
      border-bottom: none;
    }
    .nasa-bracket::after {
      bottom: -1px;
      right: -1px;
      border-left: none;
      border-top: none;
    }
    
    .glass {
      background: rgba(0, 5, 16, 0.85);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(0, 212, 255, 0.3);
      will-change: transform;
      transform: translateZ(0);
    }
    
    @keyframes scan {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100vh); }
    }
    .scan-line {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to bottom, transparent, rgba(0, 212, 255, 0.5), transparent);
      animation: scan 8s linear infinite;
      pointer-events: none;
      z-index: 100;
    }
    
    /* Mobile optimizations */
    @media (max-width: 640px) {
      #three-canvas {
        transform: scale(1.1);
      }
      .glass {
        backdrop-filter: blur(8px);
      }
    }
    
    /* Touch-friendly interactions */
    .touch-manipulation {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    
    #space-gallery-canvas {
      width: 100%;
      height: 500px;
      border-radius: 0.5rem;
      cursor: grab;
    }
    #space-gallery-canvas:active {
      cursor: grabbing;
    }
    
    .space-object-item {
      padding: 0.75rem;
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .space-object-item:hover {
      background: rgba(0, 212, 255, 0.15);
      border-color: rgba(0, 212, 255, 0.5);
    }
    .space-object-item.active {
      background: rgba(0, 212, 255, 0.25);
      border-color: #00d4ff;
    }
    
    /* Winning Animation */
    @keyframes winPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(0, 212, 255, 0);
      }
      25% {
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 50px rgba(0, 212, 255, 1);
      }
      75% {
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
      }
    }
    
    @keyframes winGlow {
      0%, 100% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(2);
      }
    }
    
    @keyframes titleGlow {
      0%, 100% {
        text-shadow: 0 0 20px rgba(0, 212, 255, 0.8), 0 0 40px rgba(0, 212, 255, 0.4);
      }
      50% {
        text-shadow: 0 0 30px rgba(0, 212, 255, 1), 0 0 60px rgba(0, 212, 255, 0.6), 0 0 80px rgba(77, 255, 219, 0.4);
      }
    }
    
    .title-glow {
      animation: titleGlow 3s ease-in-out infinite;
    }
    
    .winning-cell {
      animation: winPulse 0.6s ease-in-out, winGlow 1s ease-in-out infinite !important;
      background: rgba(0, 212, 255, 0.3) !important;
      border-color: #00d4ff !important;
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.8) !important;
    }

    #winning-line {
      opacity: 0;
      transition: opacity 0.3s ease-out;
    }

    #winning-line.active {
      opacity: 1;
      animation: neonPulse 1.5s ease-in-out infinite;
    }

    @keyframes neonPulse {
      0%, 100% {
        filter: drop-shadow(0 0 8px #00d4ff) drop-shadow(0 0 15px #00d4ff);
      }
      50% {
        filter: drop-shadow(0 0 15px #00ffff) drop-shadow(0 0 25px #00ffff);
      }
    }

    @keyframes drawLine {
      from {
        stroke-dashoffset: 1000;
      }
      to {
        stroke-dashoffset: 0;
      }
    }
    
    /* Accessibility Modes */
    body.high-contrast {
      --nasa: #00ffff;
      --earth: #00ff00;
      --mars: #ff0000;
    }
    
    body.high-contrast .glass {
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid #00ffff;
    }
    
    body.colorblind .text-mars {
      color: #0066ff !important;
    }
    
    body.colorblind .text-earth {
      color: #ffaa00 !important;
    }
    
    body.colorblind .border-mars\\/50 {
      border-color: rgba(0, 102, 255, 0.5) !important;
    }
    
    body.colorblind .border-earth\\/50 {
      border-color: rgba(255, 170, 0, 0.5) !important;
    }
    
    /* Victory Screen Animation */
    @keyframes victoryBounce {
      0%, 100% {
        transform: scale(1) rotate(0deg);
      }
      25% {
        transform: scale(1.2) rotate(-5deg);
      }
      50% {
        transform: scale(1.1) rotate(5deg);
      }
      75% {
        transform: scale(1.2) rotate(-5deg);
      }
    }
    
    @keyframes victoryShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        font-size: 14px;
      }
      
      h1 {
        font-size: 1.5rem !important;
      }
      
      h2 {
        font-size: 1.25rem !important;
      }
      
      .glass {
        padding: 1rem !important;
      }
      
      button:not(.aspect-square) {
        padding: 0.5rem 1rem !important;
        font-size: 0.875rem !important;
      }
      
      #space-gallery-3d {
        height: 300px !important;
      }
      
      .space-object-item {
        padding: 0.5rem !important;
        font-size: 0.875rem !important;
      }
      
      /* Game board mobile */
      .grid-cols-3 {
        gap: 0.5rem !important;
      }
      
      /* Hide scan line on mobile for performance */
      .scan-line {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      h1 {
        font-size: 1.25rem !important;
      }
      
      .glass {
        padding: 0.75rem !important;
      }
      
      button:not(.aspect-square) {
        padding: 0.4rem 0.8rem !important;
        font-size: 0.75rem !important;
      }
      
      #space-gallery-3d {
        height: 250px !important;
      }
      
      input {
        font-size: 14px !important;
      }
    }
    
    /* Touch-friendly interactions */
    @media (hover: none) and (pointer: coarse) {
      button, .space-object-item {
        min-height: 44px;
        min-width: 44px;
      }
      
      .space-object-item {
        padding: 1rem !important;
      }
    }
  </style>
</head>
<body class="bg-space text-white min-h-screen overflow-x-hidden" x-data="app()" x-init="init()">
  <button @click="toggleMute()" class="fixed top-4 right-4 z-50 glass p-2 rounded-full hover:bg-gray-800 transition" :class="muted ? 'text-gray-500' : 'text-nasa'"><svg x-show="!muted" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg><svg x-show="muted" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg></button>
  
  <canvas id="three-canvas"></canvas>
  <div class="scan-line"></div>
  <canvas id="fw-canvas" style="position:fixed;inset:0;pointer-events:none;z-index:99"></canvas>
  
  <!-- Home/Landing Screen -->
  <div x-show="screen === 'home'" class="content-layer min-h-screen flex items-center justify-center p-4 sm:p-6">
    <div class="max-w-4xl w-full text-center">
      <div class="mb-6 sm:mb-8">
        <div class="text-nasa text-xs sm:text-sm tracking-widest mb-3 sm:mb-4 animate-pulse">‚óÜ MISSION CONTROL ‚óÜ</div>
        <h1 class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-bold tracking-wider mb-3 sm:mb-4 px-2 text-nasa title-glow">
          TIC TAC TOE
        </h1>
        <p class="text-lg sm:text-xl md:text-2xl text-gray-300 tracking-wide mb-2 px-2">TACTICAL GRID COMBAT SYSTEM</p>
        <p class="text-xs sm:text-sm text-gray-500 tracking-widest px-2">REAL-TIME MULTIPLAYER ‚Ä¢ AI OPPONENT ‚Ä¢ 3D SPACE</p>
      </div>

      <div class="glass nasa-bracket rounded-lg p-6 sm:p-8 md:p-12 shadow-2xl mb-6 sm:mb-8 max-w-2xl mx-auto">
        <div class="grid grid-cols-3 gap-3 sm:gap-4 md:gap-6 mb-6 sm:mb-8">
          <div class="text-center">
            <div class="text-3xl sm:text-4xl mb-1 sm:mb-2">üåê</div>
            <div class="text-nasa font-bold mb-1 text-xs sm:text-sm md:text-base">MULTIPLAYER</div>
            <div class="text-[10px] sm:text-xs text-gray-400 hidden sm:block">Play with friends online</div>
          </div>
          <div class="text-center">
            <div class="text-3xl sm:text-4xl mb-1 sm:mb-2">ü§ñ</div>
            <div class="text-earth font-bold mb-1 text-xs sm:text-sm md:text-base">AI OPPONENT</div>
            <div class="text-[10px] sm:text-xs text-gray-400 hidden sm:block">Challenge unbeatable AI</div>
          </div>
          <div class="text-center">
            <div class="text-3xl sm:text-4xl mb-1 sm:mb-2">üåå</div>
            <div class="text-mars font-bold mb-1 text-xs sm:text-sm md:text-base">3D SPACE</div>
            <div class="text-[10px] sm:text-xs text-gray-400 hidden sm:block">Explore the solar system</div>
          </div>
        </div>

        <button @click="setScreen('auth')" 
                class="w-full bg-gradient-to-r from-nasa to-earth text-black font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-lg text-lg sm:text-xl tracking-wider hover:shadow-lg hover:shadow-nasa/50 transition-all transform active:scale-95 sm:hover:scale-105">
          üöÄ LAUNCH MISSION
        </button>
      </div>

      <div class="text-gray-500 text-[10px] sm:text-xs tracking-wider space-y-1 px-2">
        <p class="hidden sm:block">NASA-INSPIRED DESIGN ‚Ä¢ REAL-TIME WEATHER ‚Ä¢ CINEMATIC 3D GRAPHICS</p>
        <p class="sm:hidden">NASA DESIGN ‚Ä¢ WEATHER SYNC ‚Ä¢ 3D GRAPHICS</p>
        <p x-show="weather" class="text-nasa/70 text-xs sm:text-sm">
          <span x-show="weather === 'clear'">‚òÄÔ∏è CLEAR SKY MODE</span>
          <span x-show="weather === 'cloudy'">‚òÅÔ∏è MISTY ATMOSPHERE</span>
          <span x-show="weather === 'rain'">üåßÔ∏è STORM MODE</span>
          <span x-show="weather === 'snow'">‚ùÑÔ∏è FROZEN SPACE</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Auth Screen -->
  <div x-show="screen === 'auth'" class="content-layer min-h-screen flex items-center justify-center p-4 sm:p-6">
    <div class="max-w-md w-full">
      <div class="text-center mb-6 sm:mb-8">
        <div class="text-nasa text-sm tracking-widest mb-2">‚óÜ MISSION CONTROL ‚óÜ</div>
        <h1 class="text-5xl font-bold tracking-wider mb-2">TIC TAC TOE</h1>
        <p class="text-gray-400 text-sm tracking-wide">TACTICAL GRID COMBAT SYSTEM</p>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-6 shadow-2xl">
        <div class="flex gap-2 mb-6">
          <button @click="authTab = 'login'" 
                  :class="authTab === 'login' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            SIGN IN
          </button>
          <button @click="authTab = 'register'" 
                  :class="authTab === 'register' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            REGISTER
          </button>
        </div>
        
        <!-- Google Sign In Button -->
        <button @click="loginWithGoogle()" class="w-full bg-white text-gray-800 font-bold py-3 rounded hover:bg-gray-100 transition mb-2 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" viewBox="0 0 24 24">
            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          Continue with Google
        </button>
        
        <!-- Facebook Sign In Button -->
        <button @click="loginWithFacebook()" class="w-full bg-blue-600 text-white font-bold py-3 rounded hover:bg-blue-700 transition mb-4 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
          Continue with Facebook
        </button>
        
        <div class="relative mb-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-700"></div>
          </div>
          <div class="relative flex justify-center text-xs">
            <span class="px-2 bg-gray-900 text-gray-400">OR</span>
          </div>
        </div>
        
        <!-- Guest Login Button -->
        <button @click="guestLogin()" :disabled="guestLoading"
                class="w-full bg-gradient-to-r from-gray-700 to-gray-600 text-white font-bold py-3 rounded hover:from-gray-600 hover:to-gray-500 transition disabled:opacity-50 tracking-wider mb-6 flex items-center justify-center gap-2">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
          </svg>
          <span x-show="!guestLoading">üéÆ PLAY AS GUEST</span>
          <span x-show="guestLoading">CONNECTING...</span>
        </button>
        
        <div class="relative mb-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-700"></div>
          </div>
          <div class="relative flex justify-center text-xs">
            <span class="px-2 bg-gray-900 text-gray-400">OR LOGIN WITH ACCOUNT</span>
          </div>
        </div>
        
        <form x-show="authTab === 'login'" @submit.prevent="login()" class="space-y-4">
          <div>
            <label for="login-username" class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN</label>
            <input id="login-username" name="username" x-model="loginForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Enter callsign">
          </div>
          <div>
            <label for="login-password" class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE</label>
            <input id="login-password" name="password" x-model="loginForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div x-show="loginError" x-text="loginError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="loginLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!loginLoading">INITIATE LOGIN ‚Üí</span>
            <span x-show="loginLoading">AUTHENTICATING...</span>
          </button>
        </form>
        
        <form x-show="authTab === 'register'" @submit.prevent="register()" class="space-y-4">
          <div>
            <label for="register-username" class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN <span class="text-gray-500">(3-16 chars)</span></label>
            <input id="register-username" name="username" x-model="registerForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Choose callsign">
          </div>
          <div>
            <label for="register-password" class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE <span class="text-gray-500">(min 8 chars)</span></label>
            <input id="register-password" name="password" x-model="registerForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Set access code">
          </div>
          <div x-show="registerError" x-text="registerError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="registerLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!registerLoading">REGISTER OPERATOR ‚Üí</span>
            <span x-show="registerLoading">CREATING...</span>
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Lobby Screen -->
  <div x-show="screen === 'lobby'" class="content-layer min-h-screen p-3 sm:p-4">
    <div class="max-w-4xl mx-auto">
      <!-- Header - Mobile Optimized -->
      <div class="mb-4 sm:mb-6">
        <div class="text-nasa text-xs tracking-widest">‚óÜ MISSION CONTROL ‚óÜ</div>
        <div class="text-2xl sm:text-3xl font-bold tracking-wide truncate" x-text="user.username"></div>
        <div class="text-xs text-gray-400 mt-1 flex flex-wrap gap-2">
          <span class="text-nasa" x-text="getELORank()"></span>
          <span>‚Ä¢</span>
          <span x-text="'ELO: ' + user.elo"></span>
          <span>‚Ä¢</span>
          <span x-text="'Streak: ' + user.stats.winStreak"></span>
        </div>
      </div>
      
      <!-- Action Buttons - Mobile Grid -->
      <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-2 mb-4 sm:mb-6">
        <button @click="showProfile = true" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm">üë§</button>
        <button @click="showAchievements = true" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm">üèÜ</button>
        <button @click="showSettings = true" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm">‚öôÔ∏è</button>
        <button @click="openSpaceGallery()" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm">üåå</button>
        <button @click="showFriends = true" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm hidden sm:block">üë•</button>
        <button @click="showStats = true" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm hidden sm:block">üìä</button>
        <button @click="logout()" class="bg-gray-800 px-3 py-2 rounded hover:bg-gray-700 transition font-bold text-sm col-span-2 sm:col-span-1">LOGOUT</button>
      </div>
      
      <!-- Stats - Mobile Optimized -->
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6">
        <div class="glass rounded px-3 sm:px-6 py-2 sm:py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">W</span>
          <span class="font-bold text-lg ml-1" x-text="user.stats.wins">0</span>
        </div>
        <div class="glass rounded px-3 sm:px-6 py-2 sm:py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">D</span>
          <span class="font-bold text-lg ml-1" x-text="user.stats.draws">0</span>
        </div>
        <div class="glass rounded px-3 sm:px-6 py-2 sm:py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">L</span>
          <span class="font-bold text-lg ml-1" x-text="user.stats.losses">0</span>
        </div>
        <div class="glass rounded px-3 sm:px-6 py-2 sm:py-3 border border-earth/50">
          <span class="text-earth text-xs tracking-wider">BEST</span>
          <span class="font-bold text-lg ml-1" x-text="user.stats.bestStreak">0</span>
        </div>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-4 sm:p-6 space-y-4 sm:space-y-6 shadow-2xl">
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3 sm:mb-4">üöÄ MULTIPLAYER MISSION</h3>
          <!-- Mobile: Stack buttons vertically -->
          <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
            <button @click="createRoom()" class="w-full sm:flex-1 bg-nasa text-black font-bold py-3 sm:py-4 rounded hover:bg-nasa/90 transition tracking-wide text-sm sm:text-base">
              + LAUNCH ROOM
            </button>
            <div class="w-full sm:flex-1 flex gap-2">
              <input id="join-code" name="roomCode" x-model="joinCode" type="text" maxlength="4" placeholder="CODE"
                     class="flex-1 bg-gray-800 border border-gray-700 rounded px-3 sm:px-4 uppercase text-center focus:border-nasa focus:outline-none transition text-sm sm:text-base">
              <button @click="joinRoom()" class="bg-gray-800 px-4 sm:px-6 rounded hover:bg-gray-700 transition font-bold text-sm sm:text-base">DOCK ‚Üí</button>
            </div>
          </div>
          <!-- Tournament buttons - Stack on mobile -->
          <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 mt-3 sm:mt-4">
             <button @click="createTournament()" class="w-full sm:flex-1 bg-purple-600 text-white font-bold py-3 sm:py-4 rounded hover:bg-purple-700 transition tracking-wide text-sm sm:text-base">
               üèÜ HOST TOURNAMENT
             </button>
             <button @click="joinTournament()" class="w-full sm:flex-1 bg-purple-900/50 border border-purple-500 text-white font-bold py-3 sm:py-4 rounded hover:bg-purple-900 transition tracking-wide text-sm sm:text-base">
               JOIN TOURNAMENT
             </button>
          </div>
          <div x-show="lobbyError" x-text="lobbyError" class="text-mars text-sm mt-2"></div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3 sm:mb-4">‚öôÔ∏è GAME SETTINGS</h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4">
            <div>
              <label class="text-xs text-gray-400 mb-2 block">BOARD SIZE</label>
              <select x-model="boardSize" class="w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 focus:border-nasa focus:outline-none text-sm sm:text-base">
                <option value="3">3x3 Classic</option>
                <option value="4">4x4 Advanced</option>
                <option value="5">5x5 Expert</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-gray-400 mb-2 block">GAME MODE</label>
              <select x-model="gameMode" class="w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 focus:border-nasa focus:outline-none text-sm sm:text-base">
                <option value="classic">Classic</option>
                <option value="blitz">‚ö° Blitz (60s)</option>
                <option value="educational">üéì Educational</option>
              </select>
            </div>
          </div>
          <div>
            <label class="text-xs text-gray-400 mb-2 block">BOARD THEME</label>
            <div class="grid grid-cols-3 sm:grid-cols-5 gap-2">
              <button @click="boardTheme = 'space'" :class="boardTheme === 'space' ? 'border-nasa bg-nasa/20' : 'border-gray-700'" class="glass rounded p-2 border-2 text-xs hover:border-nasa/50 transition">üåå</button>
              <button @click="boardTheme = 'mars'" :class="boardTheme === 'mars' ? 'border-mars bg-mars/20' : 'border-gray-700'" class="glass rounded p-2 border-2 text-xs hover:border-mars/50 transition">üî¥</button>
              <button @click="boardTheme = 'moon'" :class="boardTheme === 'moon' ? 'border-gray-400 bg-gray-400/20' : 'border-gray-700'" class="glass rounded p-2 border-2 text-xs hover:border-gray-400/50 transition">üåô</button>
              <button @click="boardTheme = 'jupiter'" :class="boardTheme === 'jupiter' ? 'border-earth bg-earth/20' : 'border-gray-700'" class="glass rounded p-2 border-2 text-xs hover:border-earth/50 transition">ü™ê</button>
              <button @click="boardTheme = 'nebula'" :class="boardTheme === 'nebula' ? 'border-purple-500 bg-purple-500/20' : 'border-gray-700'" class="glass rounded p-2 border-2 text-xs hover:border-purple-500/50 transition">üí´</button>
            </div>
          </div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3 sm:mb-4">ü§ñ TRAINING MODE</h3>
          <div class="grid grid-cols-3 gap-2 mb-3 sm:mb-4">
            <button @click="setDifficulty('easy')"
                    :class="aiDifficulty === 'easy' ? 'bg-[#4dffdb] text-black border-[#4dffdb]' : 'bg-gray-800 text-[#4dffdb] border-gray-700'"
                    class="font-bold py-2 sm:py-3 rounded border transition hover:bg-[#4dffdb]/20 text-xs sm:text-sm tracking-wider">
              EASY
            </button>
            <button @click="setDifficulty('normal')"
                    :class="aiDifficulty === 'normal' ? 'bg-[#00d4ff] text-black border-[#00d4ff]' : 'bg-gray-800 text-[#00d4ff] border-gray-700'"
                    class="font-bold py-2 sm:py-3 rounded border transition hover:bg-[#00d4ff]/20 text-xs sm:text-sm tracking-wider">
              NORMAL
            </button>
            <button @click="setDifficulty('hard')"
                    :class="aiDifficulty === 'hard' ? 'bg-[#ff6b35] text-black border-[#ff6b35]' : 'bg-gray-800 text-[#ff6b35] border-gray-700'"
                    class="font-bold py-2 sm:py-3 rounded border transition hover:bg-[#ff6b35]/20 text-xs sm:text-sm tracking-wider">
              HARD
            </button>
          </div>

          <button @click="startAI()" class="w-full bg-mars text-white font-bold py-3 sm:py-4 rounded hover:bg-mars/90 transition tracking-wide text-sm sm:text-base">
            ENGAGE AI
          </button>
          <button @click="openLeaderboard()" class="w-full bg-gray-800 text-nasa font-bold py-3 sm:py-4 rounded hover:bg-gray-700 transition tracking-wide mt-3 sm:mt-4 border border-nasa/30 text-sm sm:text-base">
            üìä VIEW LEADERBOARD
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Leaderboard -->
  <!-- Tournament Lobby -->
  <div x-show="screen === 'tournament-lobby'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 text-center shadow-2xl w-full max-w-lg">
      <div class="text-xl mb-4 text-nasa tracking-wider">TOURNAMENT LOBBY</div>
      <div class="text-6xl font-bold text-nasa mb-2 tracking-widest" x-text="tournamentCode"></div>
      <div class="text-gray-400 mb-6 text-sm tracking-wide">SHARE CODE TO JOIN</div>

      <div class="space-y-2 mb-8">
        <template x-for="(player, index) in tournamentPlayers" :key="index">
          <div class="glass p-3 flex justify-between items-center">
            <span class="text-nasa font-bold" x-text="'P' + (index + 1)"></span>
            <span class="font-mono" x-text="player.name"></span>
            <span class="text-green-400 text-xs">READY</span>
          </div>
        </template>
        <template x-for="i in (4 - tournamentPlayers.length)" :key="'empty-' + i">
          <div class="glass p-3 flex justify-between items-center opacity-50">
             <span class="text-gray-600 font-bold">--</span>
             <span class="text-gray-600">WAITING...</span>
          </div>
        </template>
      </div>

      <button @click="setScreen('lobby')" class="block mx-auto text-gray-400 hover:text-white transition">‚Üê ABORT</button>
    </div>
  </div>

  <!-- Tournament Bracket -->
  <div x-show="screen === 'tournament-bracket'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 w-full max-w-4xl shadow-2xl">
      <h2 class="text-3xl font-bold text-center mb-2 tracking-widest text-nasa">TOURNAMENT BRACKET</h2>
      <div class="text-center mb-8 text-sm text-gray-400" x-text="tournamentStatus === 'completed' ? 'CHAMPION DECLARED' : 'IN PROGRESS'"></div>

      <div x-show="tournamentChampion" class="text-center mb-8 animate-bounce">
         <div class="text-6xl mb-2">üèÜ</div>
         <div class="text-2xl font-bold text-nasa">CHAMPION</div>
         <div class="text-4xl font-bold text-white" x-text="tournamentChampion"></div>
      </div>

      <div class="flex justify-around items-center gap-8 relative">
        <!-- Semifinals Column -->
        <div class="space-y-12 flex-1">
          <!-- Match 1 -->
          <div class="glass p-4 relative" :class="tournamentMatches[0]?.winner !== null ? 'opacity-50' : ''">
             <div class="text-xs text-nasa mb-2">SEMIFINAL 1</div>
             <div class="flex justify-between p-2 border-b border-gray-700" :class="tournamentMatches[0]?.winner === 0 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[0]?.p1]?.name || '...'"></span>
               <span x-show="tournamentMatches[0]?.winner === 0">‚úì</span>
             </div>
             <div class="flex justify-between p-2" :class="tournamentMatches[0]?.winner === 1 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[0]?.p2]?.name || '...'"></span>
               <span x-show="tournamentMatches[0]?.winner === 1">‚úì</span>
             </div>
          </div>

          <!-- Match 2 -->
          <div class="glass p-4 relative" :class="tournamentMatches[1]?.winner !== null ? 'opacity-50' : ''">
             <div class="text-xs text-nasa mb-2">SEMIFINAL 2</div>
             <div class="flex justify-between p-2 border-b border-gray-700" :class="tournamentMatches[1]?.winner === 2 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[1]?.p1]?.name || '...'"></span>
               <span x-show="tournamentMatches[1]?.winner === 2">‚úì</span>
             </div>
             <div class="flex justify-between p-2" :class="tournamentMatches[1]?.winner === 3 ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentPlayers[tournamentMatches[1]?.p2]?.name || '...'"></span>
               <span x-show="tournamentMatches[1]?.winner === 3">‚úì</span>
             </div>
          </div>
        </div>

        <!-- Final Column -->
        <div class="flex-1">
           <div class="glass p-6 border-2 border-nasa/50 relative">
             <div class="text-xs text-nasa mb-2 text-center">FINAL MISSION</div>
             <div class="flex justify-between p-3 border-b border-gray-700" :class="tournamentMatches[2]?.winner === tournamentMatches[2]?.p1 && tournamentMatches[2]?.p1 !== null ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentMatches[2]?.p1 !== null ? tournamentPlayers[tournamentMatches[2]?.p1]?.name : '...'"></span>
               <span x-show="tournamentMatches[2]?.winner === tournamentMatches[2]?.p1 && tournamentMatches[2]?.p1 !== null">üëë</span>
             </div>
             <div class="flex justify-between p-3" :class="tournamentMatches[2]?.winner === tournamentMatches[2]?.p2 && tournamentMatches[2]?.p2 !== null ? 'text-nasa font-bold' : ''">
               <span x-text="tournamentMatches[2]?.p2 !== null ? tournamentPlayers[tournamentMatches[2]?.p2]?.name : '...'"></span>
               <span x-show="tournamentMatches[2]?.winner === tournamentMatches[2]?.p2 && tournamentMatches[2]?.p2 !== null">üëë</span>
             </div>
           </div>
        </div>
      </div>

      <div class="mt-8 text-center">
        <button @click="exitTournament()" class="bg-gray-800 px-6 py-2 rounded hover:bg-gray-700 transition font-bold">EXIT TO LOBBY</button>
      </div>
    </div>
  </div>
  <div x-show="screen === 'leaderboard'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 w-full max-w-2xl shadow-2xl relative">
      <button @click="closeLeaderboard()" class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>
      <h2 class="text-3xl font-bold text-center mb-6 tracking-widest text-nasa">GLOBAL LEADERBOARD</h2>

      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="border-b border-gray-700 text-xs text-gray-400 tracking-wider">
              <th class="p-3">RANK</th>
              <th class="p-3">CALLSIGN</th>
              <th class="p-3 text-right">WINS</th>
                <td class="p-3 text-right font-mono text-earth" x-text="player.draws"></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <div class="mt-6 text-center">
        <button @click="closeLeaderboard()" class="bg-gray-800 px-6 py-2 rounded hover:bg-gray-700 transition font-bold">‚Üê BACK TO BASE</button>
      </div>
    </div>
  </div>

  <div x-show="screen === 'space'" class="content-layer min-h-screen p-3 sm:p-4">
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-4 sm:mb-6">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold tracking-wider">üåå SPACE EXPLORER</h2>
        <button @click="closeSpaceGallery()" class="bg-gray-800 px-4 sm:px-6 py-2 sm:py-3 rounded hover:bg-gray-700 transition font-bold text-sm sm:text-base">‚Üê BACK</button>
      </div>
      
      <div class="flex gap-2 mb-4 overflow-x-auto">
        <button @click="loadSpaceTab('solar')" 
                :class="spaceTab === 'solar' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-4 sm:px-6 py-2 rounded font-bold transition text-xs sm:text-sm whitespace-nowrap">‚òÄÔ∏è SOLAR SYSTEM</button>
        <button @click="loadSpaceTab('stars')" 
                :class="spaceTab === 'stars' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-4 sm:px-6 py-2 rounded font-bold transition text-xs sm:text-sm whitespace-nowrap">‚≠ê NEARBY STARS</button>
        <button @click="loadSpaceTab('nebulae')" 
                :class="spaceTab === 'nebulae' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-4 sm:px-6 py-2 rounded font-bold transition text-xs sm:text-sm whitespace-nowrap">üåå NEBULAE</button>
        <button @click="loadSpaceTab('constellations')" 
                :class="spaceTab === 'constellations' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-4 sm:px-6 py-2 rounded font-bold transition text-xs sm:text-sm whitespace-nowrap">‚ú® CONSTELLATIONS</button>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
        <div class="lg:col-span-3">
          <div class="glass nasa-bracket rounded-lg p-3 sm:p-4 shadow-2xl relative overflow-hidden">
            <div id="space-gallery-3d" class="rounded-lg" style="width: 100%; height: 400px; sm:height: 500px;"></div>
            
            <!-- Real-time HUD Overlay -->
            <div class="absolute top-6 left-6 glass rounded px-3 py-2 text-xs space-y-1 pointer-events-none">
              <div class="text-nasa tracking-wider">‚óÜ TELEMETRY ‚óÜ</div>
              <div id="hud-camera" class="text-gray-300">CAM: 0, 0, 0</div>
              <div id="hud-target" class="text-gray-300">TGT: None</div>
              <div id="hud-zoom" class="text-gray-300">ZOOM: 1.0x</div>
            </div>
            
            <div class="flex flex-wrap gap-2 sm:gap-4 mt-3 sm:mt-4">
              <button @click="resetSpaceView()" class="bg-gray-800 px-4 sm:px-6 py-2 rounded hover:bg-gray-700 transition font-bold text-xs sm:text-sm">üîÑ RESET VIEW</button>
              <div class="text-[10px] sm:text-xs text-gray-400 flex flex-wrap items-center gap-2 sm:gap-4">
                <span>üñ±Ô∏è Drag</span>
                <span>üîç Zoom</span>
                <span>üëÜ Click</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="glass rounded-lg p-3 sm:p-4">
          <h3 class="text-nasa text-xs sm:text-sm tracking-widest mb-3 sm:mb-4">‚óÜ OBJECTS ‚óÜ</h3>
          <div class="space-y-2 max-h-96 overflow-y-auto" id="space-objects-list">
            <!-- Objects will be populated by JavaScript -->
          </div>
          
          <div x-show="selectedObject" class="mt-4 pt-4 border-t border-nasa/30">
            <h4 class="text-nasa text-xs tracking-widest mb-2">‚óÜ DETAILS ‚óÜ</h4>
            <div class="text-xs sm:text-sm space-y-1" id="space-object-details">
              <!-- Details will be populated -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Waiting, Game, Game Over screens remain the same as before -->
  <!-- (keeping them short for file size) -->
  
  <div x-show="screen === 'waiting'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 text-center shadow-2xl">
      <div class="text-xl mb-4 text-nasa tracking-wider">WAITING FOR OPPONENT...</div>
      <div class="text-7xl font-bold text-nasa mb-2 tracking-widest" x-text="roomCode"></div>
      <div class="text-gray-400 mb-6 text-sm tracking-wide">SHARE THIS CODE</div>
      <button @click="copyRoomCode()" class="bg-nasa text-black px-8 py-3 rounded font-bold hover:bg-nasa/90 transition mb-4">
        üìã COPY CODE
      </button>
      <button @click="cancelWaiting()" class="block mx-auto text-gray-400 hover:text-white transition">‚Üê ABORT MISSION</button>
    </div>
  </div>
  
  <div x-show="screen === 'game'" class="content-layer min-h-screen p-3 sm:p-4">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-4 sm:mb-6">
        <div class="flex justify-between items-center mb-2">
          <div class="text-nasa text-xs sm:text-sm tracking-widest uppercase" x-text="gameStatus"></div>
          <div x-show="gameMode === 'blitz' && gameActive" class="text-mars font-bold text-lg" x-text="'‚è±Ô∏è ' + timeRemaining + 's'"></div>
        </div>
        <div class="flex justify-center gap-3 sm:gap-6 md:gap-8 text-sm sm:text-base md:text-lg font-bold">
          <div class="glass rounded px-3 sm:px-4 py-1.5 sm:py-2 border border-mars/50">
            <span class="text-mars">X:</span> <span x-text="scores.X">0</span>
          </div>
          <div class="glass rounded px-3 sm:px-4 py-1.5 sm:py-2 border border-gray-500/50">
            <span class="text-gray-400">D:</span> <span x-text="scores.D">0</span>
          </div>
          <div class="glass rounded px-3 sm:px-4 py-1.5 sm:py-2 border border-earth/50">
            <span class="text-earth">O:</span> <span x-text="scores.O">0</span>
          </div>
        </div>
      </div>
      
      <div class="relative max-w-md mx-auto mb-4 sm:mb-6 px-2 sm:px-0">
        <div :class="'grid gap-2 sm:gap-3 grid-cols-' + boardSize" 
             :style="getThemeStyle()"
             id="game-board" 
             class="rounded-lg p-2">
          <template x-for="(cell, i) in board" :key="i">
            <button @click="makeMove(i)" 
                    :disabled="!canMove(i)"
                    :data-cell-index="i"
                    :class="[
                      'aspect-square glass nasa-bracket rounded-lg font-bold active:bg-gray-800/50 sm:hover:bg-gray-800/50 disabled:cursor-not-allowed transition-all shadow-lg touch-manipulation',
                      boardSize === 3 ? 'text-4xl sm:text-5xl md:text-6xl' : boardSize === 4 ? 'text-3xl sm:text-4xl' : 'text-2xl sm:text-3xl',
                      cell === 'X' ? 'text-mars border-mars/50' : cell === 'O' ? 'text-earth border-earth/50' : 'border-nasa/30'
                    ]"
                    x-text="cell || ''">
            </button>
          </template>
        </div>
        <svg id="winning-line" class="absolute inset-0 pointer-events-none" style="width: 100%; height: 100%;">
          <line id="win-line" x1="0" y1="0" x2="0" y2="0" stroke="url(#neonGradient)" stroke-width="4" stroke-linecap="round" style="filter: drop-shadow(0 0 10px currentColor);" class="sm:stroke-[6]" />
          <defs>
            <linearGradient id="neonGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#00ffff;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:1" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      
      <!-- Educational Mode Space Fact -->
      <div x-show="gameMode === 'educational' && !gameActive && spaceFact" class="glass rounded-lg p-4 mb-4 max-w-md mx-auto border border-nasa/50">
        <div class="text-nasa text-xs tracking-widest mb-2">üåü SPACE FACT</div>
        <div class="text-sm" x-text="spaceFact"></div>
      </div>
      
      <div class="text-center">
        <button @click="leaveGame()" class="bg-gray-800 px-8 py-3 rounded hover:bg-gray-700 transition font-bold">‚Üê ABORT MISSION</button>
      </div>
    </div>
  </div>
  
  <div x-show="gameOver" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="glass nasa-bracket rounded-lg p-8 text-center max-w-md shadow-2xl"
         x-transition:enter="transition ease-out duration-500 delay-150"
         x-transition:enter-start="opacity-0 scale-50"
         x-transition:enter-end="opacity-100 scale-100">
      <div class="text-6xl mb-4" 
           x-text="gameOverEmoji"
           :style="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY') ? 'animation: victoryBounce 1s ease-in-out infinite' : ''"></div>
      <div class="text-3xl font-bold mb-2" 
           x-text="gameOverTitle"
           :style="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY') ? 'animation: victoryShake 0.5s ease-in-out' : ''"></div>
      <div class="text-nasa text-sm mb-6 tracking-wider" x-text="gameOverSubtitle"></div>
      
      <!-- Social Share Section -->
      <div x-show="gameOverTitle.includes('COMPLETE') || gameOverTitle.includes('VICTORY')" class="mb-6 pb-6 border-b border-nasa/30">
        <div class="text-xs text-gray-400 mb-3 tracking-wider">SHARE YOUR VICTORY</div>
        <div class="flex gap-2 justify-center flex-wrap">
          <button @click="shareTwitter()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path></svg>
            Twitter
          </button>
          <button @click="shareFacebook()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path></svg>
            Facebook
          </button>
          <button @click="shareWhatsApp()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path></svg>
            WhatsApp
          </button>
          <button @click="downloadScreenshot()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            Screenshot
          </button>
          <button @click="copyShareLink()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded transition flex items-center gap-2 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
            Copy Link
          </button>
        </div>
        <div x-show="shareCopied" class="text-xs text-earth mt-2 animate-pulse">‚úì Link copied to clipboard!</div>
      </div>
      
      <div class="flex gap-4">
        <button x-show="tournamentStatus" @click="viewBracket()" class="flex-1 bg-purple-600 text-white font-bold py-3 rounded hover:bg-purple-700 transition">VIEW BRACKET</button>
        <button x-show="!tournamentStatus" @click="rematch()" class="flex-1 bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition">
          RE-ENGAGE
        </button>
        <button @click="leaveGame()" class="flex-1 bg-gray-800 py-3 rounded hover:bg-gray-700 transition">
          ABORT
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div x-show="showProfile" @click.self="showProfile = false" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div class="glass nasa-bracket rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">üë§ PROFILE CUSTOMIZATION</h2>
        <button @click="showProfile = false" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      
      <div class="space-y-6">
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3">AVATAR</h3>
          <div class="grid grid-cols-5 gap-3">
            <template x-for="avatar in avatars">
              <button @click="updateProfile('avatar', avatar)" 
                      :class="user.profile.avatar === avatar ? 'border-nasa bg-nasa/20' : 'border-gray-700'"
                      class="aspect-square glass rounded-lg border-2 text-4xl hover:border-nasa/50 transition">
                <span x-text="avatar === 'astronaut' ? 'üë®‚ÄçüöÄ' : avatar === 'alien' ? 'üëΩ' : avatar === 'robot' ? 'ü§ñ' : avatar === 'satellite' ? 'üõ∞Ô∏è' : '‚òÑÔ∏è'"></span>
              </button>
            </template>
          </div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3">GAME SYMBOL</h3>
          <div class="grid grid-cols-5 gap-3">
            <template x-for="symbol in symbols">
              <button @click="updateProfile('symbol', symbol)" 
                      :class="user.profile.symbol === symbol ? 'border-nasa bg-nasa/20' : 'border-gray-700'"
                      class="aspect-square glass rounded-lg border-2 text-3xl hover:border-nasa/50 transition">
                <span x-text="symbol === 'default' ? 'X/O' : symbol === 'star' ? '‚≠ê' : symbol === 'planet' ? 'ü™ê' : symbol === 'rocket' ? 'üöÄ' : 'üåå'"></span>
              </button>
            </template>
          </div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3">BOARD THEME</h3>
          <div class="grid grid-cols-5 gap-3">
            <template x-for="theme in themes">
              <button @click="updateProfile('theme', theme); boardTheme = theme" 
                      :class="user.profile.theme === theme ? 'border-nasa bg-nasa/20' : 'border-gray-700'"
                      class="glass rounded-lg border-2 p-3 hover:border-nasa/50 transition">
                <div class="text-xs font-bold uppercase" x-text="theme"></div>
              </button>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Achievements Modal -->
  <div x-show="showAchievements" @click.self="showAchievements = false" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div class="glass nasa-bracket rounded-lg p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">üèÜ ACHIEVEMENT BADGES</h2>
        <button @click="showAchievements = false" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <template x-for="ach in achievements">
          <div :class="ach.unlocked ? 'border-nasa bg-nasa/10' : 'border-gray-700 opacity-50'" 
               class="glass rounded-lg border-2 p-4">
            <div class="flex items-start gap-4">
              <div class="text-5xl" x-text="ach.icon"></div>
              <div class="flex-1">
                <div class="font-bold text-lg" x-text="ach.name"></div>
                <div class="text-xs text-gray-400 mb-2" x-text="ach.desc"></div>
                <div x-show="ach.target && !ach.unlocked" class="text-xs text-nasa">
                  Progress: <span x-text="ach.progress || 0"></span>/<span x-text="ach.target"></span>
                </div>
                <div x-show="ach.unlocked" class="text-xs text-nasa">‚úì UNLOCKED</div>
              </div>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- Statistics Dashboard -->
  <div x-show="showStats" @click.self="showStats = false" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div class="glass nasa-bracket rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">üìä STATISTICS DASHBOARD</h2>
        <button @click="showStats = false" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="glass rounded-lg p-4 border border-nasa/50">
          <div class="text-nasa text-xs tracking-wider mb-1">TOTAL GAMES</div>
          <div class="text-3xl font-bold" x-text="user.stats.gamesPlayed">0</div>
        </div>
        <div class="glass rounded-lg p-4 border border-earth/50">
          <div class="text-earth text-xs tracking-wider mb-1">WIN RATE</div>
          <div class="text-3xl font-bold" x-text="user.stats.gamesPlayed > 0 ? Math.round((user.stats.wins / user.stats.gamesPlayed) * 100) + '%' : '0%'">0%</div>
        </div>
        <div class="glass rounded-lg p-4 border border-mars/50">
          <div class="text-mars text-xs tracking-wider mb-1">BEST STREAK</div>
          <div class="text-3xl font-bold" x-text="user.stats.bestStreak">0</div>
        </div>
      </div>
      
      <div class="glass rounded-lg p-4 mb-4">
        <h3 class="text-nasa text-sm tracking-widest mb-3">RANK PROGRESSION</h3>
        <div class="text-center">
          <div class="text-5xl mb-2">
            <span x-show="user.rank === 'Cadet'">üéñÔ∏è</span>
            <span x-show="user.rank === 'Astronaut'">üë®‚ÄçüöÄ</span>
            <span x-show="user.rank === 'Navigator'">üß≠</span>
            <span x-show="user.rank === 'Space Pilot'">‚úàÔ∏è</span>
            <span x-show="user.rank === 'Star Captain'">‚≠ê</span>
            <span x-show="user.rank === 'Galactic Commander'">üëë</span>
          </div>
          <div class="text-2xl font-bold text-nasa" x-text="user.rank">Cadet</div>
          <div class="text-xs text-gray-400 mt-2">
            <span x-show="user.stats.wins < 5">Next: Astronaut (5 wins)</span>
            <span x-show="user.stats.wins >= 5 && user.stats.wins < 10">Next: Navigator (10 wins)</span>
            <span x-show="user.stats.wins >= 10 && user.stats.wins < 25">Next: Space Pilot (25 wins)</span>
            <span x-show="user.stats.wins >= 25 && user.stats.wins < 50">Next: Star Captain (50 wins)</span>
            <span x-show="user.stats.wins >= 50 && user.stats.wins < 100">Next: Galactic Commander (100 wins)</span>
            <span x-show="user.stats.wins >= 100">Maximum Rank Achieved!</span>
          </div>
        </div>
      </div>
      
      <div class="glass rounded-lg p-4">
        <h3 class="text-nasa text-sm tracking-widest mb-3">RECENT GAMES</h3>
        <div class="space-y-2 max-h-60 overflow-y-auto">
          <template x-for="(game, i) in gameHistory.slice(-10).reverse()">
            <div class="flex justify-between items-center p-2 bg-gray-800/50 rounded">
              <span x-text="game.draw ? 'ü§ù Draw' : (game.winner === mySymbol ? 'üèÜ Victory' : '‚ùå Defeat')"></span>
              <span class="text-xs text-gray-400" x-text="Math.round(game.duration) + 's'"></span>
            </div>
          </template>
          <div x-show="gameHistory.length === 0" class="text-center text-gray-500 py-4">
            No games played yet
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Friends Modal -->
  <div x-show="showFriends" @click.self="showFriends = false" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div class="glass nasa-bracket rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">üë• FRIENDS LIST</h2>
        <button @click="showFriends = false" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      
      <div class="mb-6">
        <div class="flex gap-2">
          <input x-model="friendRequest" @keyup.enter="addFriend()" type="text" placeholder="Enter username..." 
                 class="flex-1 bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none">
          <button @click="addFriend()" class="bg-nasa text-black px-6 py-2 rounded font-bold hover:bg-nasa/90 transition">
            + ADD
          </button>
        </div>
      </div>
      
      <div class="space-y-2">
        <template x-for="friend in user.friends">
          <div class="glass rounded-lg p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
              <div class="text-3xl">üë§</div>
              <div>
                <div class="font-bold" x-text="friend"></div>
                <div class="text-xs text-gray-400">Online</div>
              </div>
            </div>
            <div class="flex gap-2">
              <button @click="challengeFriend(friend)" class="bg-nasa text-black px-4 py-2 rounded text-sm font-bold hover:bg-nasa/90 transition">
                ‚öîÔ∏è CHALLENGE
              </button>
              <button @click="removeFriend(friend)" class="bg-gray-800 px-4 py-2 rounded text-sm hover:bg-gray-700 transition">
                ‚úï
              </button>
            </div>
          </div>
        </template>
        <div x-show="user.friends.length === 0" class="text-center text-gray-500 py-8">
          No friends yet. Add some to play together!
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div x-show="showSettings" @click.self="showSettings = false" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
    <div class="glass nasa-bracket rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">‚öôÔ∏è SETTINGS</h2>
        <button @click="showSettings = false" class="text-gray-400 hover:text-white text-2xl">√ó</button>
      </div>
      
      <div class="space-y-6">
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3">üîä SOUND PACK</h3>
          <div class="grid grid-cols-2 gap-3">
            <template x-for="pack in soundPacks">
              <button @click="changeSoundPack(pack)" 
                      :class="user.profile.soundPack === pack ? 'border-nasa bg-nasa/20' : 'border-gray-700'"
                      class="glass rounded-lg border-2 p-3 hover:border-nasa/50 transition">
                <div class="text-sm font-bold uppercase" x-text="pack"></div>
              </button>
            </template>
          </div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-3">‚ôø ACCESSIBILITY</h3>
          <div class="space-y-3">
            <label class="flex items-center justify-between glass rounded-lg p-3 cursor-pointer hover:bg-gray-800/50">
              <span>High Contrast Mode</span>
              <input type="checkbox" x-model="highContrast" @change="toggleHighContrast()" class="w-5 h-5">
            </label>
            <label class="flex items-center justify-between glass rounded-lg p-3 cursor-pointer hover:bg-gray-800/50">
              <span>Colorblind Friendly</span>
              <input type="checkbox" x-model="colorblindMode" @change="toggleColorblindMode()" class="w-5 h-5">
            </label>
            <label class="flex items-center justify-between glass rounded-lg p-3 cursor-pointer hover:bg-gray-800/50">
              <span>Keyboard Navigation (1-9 keys)</span>
              <input type="checkbox" x-model="keyboardNav" @change="enableKeyboardNav()" class="w-5 h-5">
            </label>
          </div>
        </div>
        
        <div class="glass rounded-lg p-4 border border-nasa/30">
          <h3 class="text-nasa text-sm tracking-widest mb-2">üì± APP INFO</h3>
          <div class="text-xs text-gray-400 space-y-1">
            <div>Version: 2.0.0</div>
            <div>Build: Space Explorer Edition</div>
            <div>Made with ‚ù§Ô∏è for space enthusiasts</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/space-3d.js"></script>
  <script src="/space-gallery-3d.js"></script>
  <script src="/config.js"></script>
  <script src="/game-logic.js"></script>
  <script src="/sound-manager.js"></script>
  <script src="/app.js"></script>
</body>
</html>
