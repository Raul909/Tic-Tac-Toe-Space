<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe - Mission Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            space: '#000510',
            nasa: '#00d4ff',
            mars: '#ff6b35',
            earth: '#4dffdb'
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Space+Mono&display=swap');
    body { font-family: 'Space Mono', monospace; }
    h1, h2, h3 { font-family: 'Exo 2', sans-serif; }
    
    #three-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    
    .content-layer {
      position: relative;
      z-index: 1;
    }
    
    .nasa-bracket {
      position: relative;
    }
    .nasa-bracket::before,
    .nasa-bracket::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid #00d4ff;
    }
    .nasa-bracket::before {
      top: -1px;
      left: -1px;
      border-right: none;
      border-bottom: none;
    }
    .nasa-bracket::after {
      bottom: -1px;
      right: -1px;
      border-left: none;
      border-top: none;
    }
    
    .glass {
      background: rgba(0, 5, 16, 0.85);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(0, 212, 255, 0.3);
    }
    
    @keyframes scan {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100vh); }
    }
    .scan-line {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to bottom, transparent, rgba(0, 212, 255, 0.5), transparent);
      animation: scan 8s linear infinite;
      pointer-events: none;
      z-index: 100;
    }
    
    #space-gallery-canvas {
      width: 100%;
      height: 500px;
      border-radius: 0.5rem;
      cursor: grab;
    }
    #space-gallery-canvas:active {
      cursor: grabbing;
    }
    
    .space-object-item {
      padding: 0.75rem;
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .space-object-item:hover {
      background: rgba(0, 212, 255, 0.15);
      border-color: rgba(0, 212, 255, 0.5);
    }
    .space-object-item.active {
      background: rgba(0, 212, 255, 0.25);
      border-color: #00d4ff;
    }
  </style>
</head>
<body class="bg-space text-white min-h-screen overflow-x-hidden" x-data="app()" x-init="init()">
  
  <div id="three-canvas"></div>
  <div class="scan-line"></div>
  <canvas id="fw-canvas" style="position:fixed;inset:0;pointer-events:none;z-index:99"></canvas>
  
  <!-- Auth Screen -->
  <div x-show="screen === 'auth'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
      <div class="text-center mb-8">
        <div class="text-nasa text-sm tracking-widest mb-2">‚óÜ MISSION CONTROL ‚óÜ</div>
        <h1 class="text-5xl font-bold tracking-wider mb-2">TIC TAC TOE</h1>
        <p class="text-gray-400 text-sm tracking-wide">TACTICAL GRID COMBAT SYSTEM</p>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-6 shadow-2xl">
        <div class="flex gap-2 mb-6">
          <button @click="authTab = 'login'" 
                  :class="authTab === 'login' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            SIGN IN
          </button>
          <button @click="authTab = 'register'" 
                  :class="authTab === 'register' ? 'bg-nasa text-black' : 'bg-gray-800 text-white'"
                  class="flex-1 py-2 px-4 rounded font-semibold transition tracking-wider">
            REGISTER
          </button>
        </div>
        
        <form x-show="authTab === 'login'" @submit.prevent="login()" class="space-y-4">
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN</label>
            <input x-model="loginForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Enter callsign">
          </div>
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE</label>
            <input x-model="loginForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div x-show="loginError" x-text="loginError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="loginLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!loginLoading">INITIATE LOGIN ‚Üí</span>
            <span x-show="loginLoading">AUTHENTICATING...</span>
          </button>
        </form>
        
        <form x-show="authTab === 'register'" @submit.prevent="register()" class="space-y-4">
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">CALLSIGN <span class="text-gray-500">(3-16 chars)</span></label>
            <input x-model="registerForm.username" type="text" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Choose callsign">
          </div>
          <div>
            <label class="block text-xs text-nasa mb-1 tracking-widest">ACCESS CODE <span class="text-gray-500">(min 8 chars)</span></label>
            <input x-model="registerForm.password" type="password" 
                   class="w-full bg-gray-800 border border-gray-700 rounded px-4 py-2 focus:border-nasa focus:outline-none transition"
                   placeholder="Set access code">
          </div>
          <div x-show="registerError" x-text="registerError" class="text-mars text-sm"></div>
          <button type="submit" :disabled="registerLoading"
                  class="w-full bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition disabled:opacity-50 tracking-wider">
            <span x-show="!registerLoading">REGISTER OPERATOR ‚Üí</span>
            <span x-show="registerLoading">CREATING...</span>
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Lobby Screen -->
  <div x-show="screen === 'lobby'" class="content-layer min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <div>
          <div class="text-nasa text-xs tracking-widest">‚óÜ MISSION CONTROL ‚óÜ</div>
          <div class="text-3xl font-bold tracking-wide" x-text="user.username"></div>
        </div>
        <div class="flex gap-2">
          <button @click="openSpaceGallery()" class="bg-gray-800 px-4 py-2 rounded hover:bg-gray-700 transition font-bold">üåå SPACE</button>
          <button @click="logout()" class="bg-gray-800 px-4 py-2 rounded hover:bg-gray-700 transition font-bold">LOGOUT</button>
        </div>
      </div>
      
      <div class="flex gap-4 mb-6">
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">W-</span><span class="font-bold text-lg" x-text="String(user.stats.wins).padStart(2, '0')">00</span>
        </div>
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">D-</span><span class="font-bold text-lg" x-text="String(user.stats.draws).padStart(2, '0')">00</span>
        </div>
        <div class="glass rounded px-6 py-3 border border-nasa/50">
          <span class="text-nasa text-xs tracking-wider">L-</span><span class="font-bold text-lg" x-text="String(user.stats.losses).padStart(2, '0')">00</span>
        </div>
      </div>
      
      <div class="glass nasa-bracket rounded-lg p-6 space-y-6 shadow-2xl">
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-4">üöÄ MULTIPLAYER MISSION</h3>
          <div class="flex gap-4">
            <button @click="createRoom()" class="flex-1 bg-nasa text-black font-bold py-4 rounded hover:bg-nasa/90 transition tracking-wide">
              + LAUNCH ROOM
            </button>
            <div class="flex-1 flex gap-2">
              <input x-model="joinCode" type="text" maxlength="4" placeholder="CODE"
                     class="flex-1 bg-gray-800 border border-gray-700 rounded px-4 uppercase text-center focus:border-nasa focus:outline-none transition">
              <button @click="joinRoom()" class="bg-gray-800 px-6 rounded hover:bg-gray-700 transition font-bold">DOCK ‚Üí</button>
            </div>
          </div>
          <div x-show="lobbyError" x-text="lobbyError" class="text-mars text-sm mt-2"></div>
        </div>
        
        <div>
          <h3 class="text-nasa text-sm tracking-widest mb-4">ü§ñ TRAINING MODE</h3>
          <button @click="startAI()" class="w-full bg-mars text-white font-bold py-4 rounded hover:bg-mars/90 transition tracking-wide">
            ENGAGE AI
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Space Gallery -->
  <div x-show="screen === 'space'" class="content-layer min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-4xl font-bold tracking-wider">üåå SPACE EXPLORER</h2>
        <button @click="closeSpaceGallery()" class="bg-gray-800 px-6 py-3 rounded hover:bg-gray-700 transition font-bold">‚Üê BACK</button>
      </div>
      
      <div class="flex gap-2 mb-4">
        <button @click="spaceTab = 'solar'" 
                :class="spaceTab === 'solar' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">SOLAR SYSTEM</button>
        <button @click="spaceTab = 'stars'" 
                :class="spaceTab === 'stars' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">NEARBY STARS</button>
        <button @click="spaceTab = 'nebulae'" 
                :class="spaceTab === 'nebulae' ? 'bg-nasa text-black' : 'bg-gray-800'"
                class="px-6 py-2 rounded font-bold transition">NEBULAE</button>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
        <div class="lg:col-span-3">
          <div class="glass nasa-bracket rounded-lg p-4 shadow-2xl">
            <canvas id="space-gallery-canvas"></canvas>
            <div class="flex gap-4 mt-4">
              <div class="flex-1">
                <label class="text-xs text-nasa tracking-wider">ZOOM</label>
                <input type="range" min="0.5" max="3" step="0.1" value="1" 
                       class="w-full" x-model="spaceZoom">
              </div>
              <div class="flex-1">
                <label class="text-xs text-nasa tracking-wider">SPEED</label>
                <input type="range" min="0" max="5" step="0.5" value="1" 
                       class="w-full" x-model="spaceSpeed">
              </div>
              <button @click="resetSpaceView()" class="bg-gray-800 px-4 rounded hover:bg-gray-700 transition">RESET</button>
            </div>
          </div>
        </div>
        
        <div class="glass rounded-lg p-4">
          <h3 class="text-nasa text-sm tracking-widest mb-4">OBJECTS</h3>
          <div class="space-y-2 max-h-96 overflow-y-auto" id="space-objects-list">
            <!-- Objects will be populated by JavaScript -->
          </div>
          
          <div x-show="selectedObject" class="mt-4 pt-4 border-t border-nasa/30">
            <h4 class="text-nasa text-xs tracking-widest mb-2">DETAILS</h4>
            <div class="text-sm space-y-1" id="space-object-details">
              <!-- Details will be populated -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Waiting, Game, Game Over screens remain the same as before -->
  <!-- (keeping them short for file size) -->
  
  <div x-show="screen === 'waiting'" class="content-layer min-h-screen flex items-center justify-center p-4">
    <div class="glass nasa-bracket rounded-lg p-8 text-center shadow-2xl">
      <div class="text-xl mb-4 text-nasa tracking-wider">WAITING FOR OPPONENT...</div>
      <div class="text-7xl font-bold text-nasa mb-2 tracking-widest" x-text="roomCode"></div>
      <div class="text-gray-400 mb-6 text-sm tracking-wide">SHARE THIS CODE</div>
      <button @click="copyRoomCode()" class="bg-nasa text-black px-8 py-3 rounded font-bold hover:bg-nasa/90 transition mb-4">
        üìã COPY CODE
      </button>
      <button @click="cancelWaiting()" class="block mx-auto text-gray-400 hover:text-white transition">‚Üê ABORT MISSION</button>
    </div>
  </div>
  
  <div x-show="screen === 'game'" class="content-layer min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-6">
        <div class="text-nasa text-sm tracking-widest mb-2 uppercase" x-text="gameStatus"></div>
        <div class="flex justify-center gap-8 text-lg font-bold">
          <div class="glass rounded px-4 py-2 border border-mars/50">
            <span class="text-mars">X:</span> <span x-text="scores.X">0</span>
          </div>
          <div class="glass rounded px-4 py-2 border border-gray-500/50">
            <span class="text-gray-400">D:</span> <span x-text="scores.D">0</span>
          </div>
          <div class="glass rounded px-4 py-2 border border-earth/50">
            <span class="text-earth">O:</span> <span x-text="scores.O">0</span>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-3 gap-3 max-w-md mx-auto mb-6">
        <template x-for="(cell, i) in board" :key="i">
          <button @click="makeMove(i)" 
                  :disabled="!canMove(i)"
                  class="aspect-square glass nasa-bracket rounded-lg text-6xl font-bold hover:bg-gray-800/50 disabled:cursor-not-allowed transition-all shadow-lg"
                  :class="cell === 'X' ? 'text-mars border-mars/50' : cell === 'O' ? 'text-earth border-earth/50' : 'border-nasa/30'"
                  x-text="cell || ''">
          </button>
        </template>
      </div>
      
      <div class="text-center">
        <button @click="leaveGame()" class="bg-gray-800 px-8 py-3 rounded hover:bg-gray-700 transition font-bold">‚Üê ABORT MISSION</button>
      </div>
    </div>
  </div>
  
  <div x-show="gameOver" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
    <div class="glass nasa-bracket rounded-lg p-8 text-center max-w-md shadow-2xl">
      <div class="text-6xl mb-4" x-text="gameOverEmoji"></div>
      <div class="text-3xl font-bold mb-2" x-text="gameOverTitle"></div>
      <div class="text-nasa text-sm mb-6 tracking-wider" x-text="gameOverSubtitle"></div>
      <div class="flex gap-4">
        <button @click="rematch()" class="flex-1 bg-nasa text-black font-bold py-3 rounded hover:bg-nasa/90 transition">
          RE-ENGAGE
        </button>
        <button @click="leaveGame()" class="flex-1 bg-gray-800 py-3 rounded hover:bg-gray-700 transition">
          ABORT
        </button>
      </div>
    </div>
  </div>

  <script src="/space-3d.js"></script>
  <script src="/app.js"></script>
</body>
</html>
